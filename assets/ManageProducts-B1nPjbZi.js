import{r as l,j as e,c as Ce,a0 as ve,a as W,C as V,x as we,z as Ee,a2 as Oe,ag as k,b as f,A as R,i as S,m as w,e as E,f as O,g as P,y as K,n as Pe,h as N,B as v,o as Ne}from"./vendor-wMn6iGPg.js";import{am as Se,_ as _e,an as Le,ao as ke,ap as Re,k as Ve,n as qe,aq as He,al as Q,ar as Me,a as Fe,a1 as Ae,u as Z,as as $,at as I,a2 as De,U as Be,q as Ue,au as Ge}from"./index-8i8i33M2.js";import{E as T}from"./EditIcon-jeAxN2UI.js";import{D as X}from"./DeleteIcon-6Ouv8ePB.js";/* empty css                    */import{d as ze,u as We,g as Ze,a as $e}from"./categories-z9qAT11B.js";import{r as Ie}from"./image-alM4RakH.js";import{c as Je,a as J,b as Ke}from"./index.esm-zRHKBjC2.js";function Y({id:n,title:r,img:c,price:a,currency:d,index:g,productInput:h,setProductInput:u,onProductEditOpen:x,onProductDeleteOpen:p,isAvalaible:y,isRecomended:m}){const[t,i]=l.useState(y),[o,b]=l.useState(m),q=async()=>{i(!t),await ke(n,!t)},H=async()=>{b(!o),await Re(n,!o)};return e.jsxs(Ce,{shadow:"sm",isPressable:!0,style:Se,className:"producto-card",children:[e.jsxs(ve,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{className:"flex",children:[e.jsx(W,{isSelected:o,onValueChange:H}),e.jsx("p",{className:"text-sm text-default-500",children:"Recomandado"})]}),e.jsxs("div",{className:"flex",children:[e.jsx(W,{isSelected:t,onValueChange:q}),e.jsx("p",{className:"text-sm text-default-500",children:"Activo"})]}),e.jsxs("div",{className:"flex",style:{gap:"10px"},children:[e.jsx(V,{content:"Editar producto",children:e.jsx("span",{className:"text-lg text-default-500 cursor-pointer active:opacity-50",onClick:()=>{u(h),x()},children:e.jsx(T,{})})}),e.jsx(V,{color:"danger",content:"Eliminar producto",children:e.jsx("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>{u(h),p()},children:e.jsx(X,{})})})]})]}),e.jsx(we,{className:"overflow-visible p-0",style:_e,children:e.jsx(Ee,{radius:"lg",width:"100%",alt:"Card background NextUI hero Image with delay",className:"object-cover rounded-xl",src:c,style:Le})}),e.jsxs(Oe,{className:"text-small justify-between",children:[e.jsx("b",{children:r}),e.jsxs("p",{className:"text-default-500",children:[a," ",d]})]})]},g)}Y.propTypes={title:k.string.isRequired,img:k.string.isRequired,price:k.number.isRequired,index:k.number.isRequired};function Qe({user:n,category:r,products:c,onOpen:a,setProductInput:d,onProductEditOpen:g,onProductDeleteOpen:h,categoryInput:u,onCategoryEditOpen:x,onCategoryDeleteOpen:p}){const[y,m]=l.useState(window.screen.width);return l.useEffect(()=>{const t=()=>m(window.screen.width);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),e.jsxs("div",{style:{borderRadius:"20px",boxShadow:"5px 5px 15px rgba(0, 0, 0, 0.3)",padding:"20px",marginBottom:"30px"},children:[e.jsx("h4",{style:{marginTop:"10px",marginBottom:"10px"},children:r.category}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(f,{className:"text-white",color:"secondary",variant:"shadow",onClick:()=>{if(c.length===3&&n.plan==="gratis"){R.error("Ha excedido el máximo de productos que puede añadir con su plan.");return}d(t=>({...t,category:r.id})),a()},children:"Agregar Producto"}),e.jsxs("div",{className:"flex",style:{gap:"10px"},children:[e.jsx(V,{content:"Editar categoría",children:e.jsx("span",{className:"text-lg text-default-500 cursor-pointer active:opacity-50",onClick:()=>{u.current={...u.current,id:r.id,category:r.category},x()},children:e.jsx(T,{})})}),e.jsx(V,{color:"danger",content:"Eliminar categoría",children:e.jsx("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>{u.current={...u.current,id:r.id,category:r.category},p()},children:e.jsx(X,{})})})]})]}),e.jsx("div",{className:"mt-2 list-container",style:y<800?Ve:qe,children:c.map((t,i)=>e.jsx(Y,{price:t.price,index:i,id:t.id,img:t.image,title:t.name,description:t.description,currency:t.currency,onOpen:a,onProductDeleteOpen:h,productInput:t,setProductInput:d,onProductEditOpen:g,isAvalaible:t.isAvalaible,isRecomended:t.isRecomended},i+1))})]})}const ee=({width:n})=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:n,children:[e.jsx("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),e.jsx("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsxs("g",{id:"SVGRepo_iconCarrier",children:[" ",e.jsx("path",{d:"M15 21H9C6.17157 21 4.75736 21 3.87868 20.1213C3 19.2426 3 17.8284 3 15M21 15C21 17.8284 21 19.2426 20.1213 20.1213C19.8215 20.4211 19.4594 20.6186 19 20.7487",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})," ",e.jsx("path",{d:"M12 16V3M12 3L16 7.375M12 3L8 7.375",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})," "]})]}),Te=({onOpen:n})=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:100,onClick:n,children:[e.jsx("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),e.jsx("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsxs("g",{id:"SVGRepo_iconCarrier",children:[" ",e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.75 4.5L4.5 3.75H10.5L11.25 4.5V10.5L10.5 11.25H4.5L3.75 10.5V4.5ZM5.25 5.25V9.75H9.75V5.25H5.25ZM13.5 3.75L12.75 4.5V10.5L13.5 11.25H19.5L20.25 10.5V4.5L19.5 3.75H13.5ZM14.25 9.75V5.25H18.75V9.75H14.25ZM17.25 20.25H15.75V17.25H12.75V15.75H15.75V12.75H17.25V15.75H20.25V17.25H17.25V20.25ZM4.5 12.75L3.75 13.5V19.5L4.5 20.25H10.5L11.25 19.5V13.5L10.5 12.75H4.5ZM5.25 18.75V14.25H9.75V18.75H5.25Z",fill:"#5E17EB"})," "]})]});function se({value:n,setValues:r}){return e.jsx(S,{type:"number",label:"Precio",placeholder:"0.00",variant:"bordered",value:n.price,isInvalid:typeof n.price=="string",onChange:c=>{r({...n,price:parseFloat(c.target.value)})},startContent:e.jsx("div",{className:"pointer-events-none flex items-center",children:e.jsx("span",{className:"text-default-400 text-small",children:"$"})}),endContent:e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"sr-only",htmlFor:"currency",children:"Currency"}),e.jsxs("select",{className:"outline-none border-0 bg-transparent text-default-400 text-small",id:"currency",name:"currency",value:n.currency,onChange:c=>{r({...n,currency:c.target.value})},children:[e.jsx("option",{children:"CUP"}),e.jsx("option",{children:"MLC"}),e.jsx("option",{children:"EUR"}),e.jsx("option",{children:"USD"})]})]})})}function Xe({isOpen:n,onOpen:r,onOpenChange:c,productInput:a,setProductInput:d,handleImageChange:g,imageName:h,setImageName:u,fetchProducts:x,bussiness:p}){const[y,m]=l.useState(!1),t=async()=>{if(await He(a,h),p){let i={message:`El negocio ${p.name} ha cambiado el producto ${a.name}.`,bussiness:p.id,addressee:null,bussiness_link:p.value_url};Q(i)}u(""),d({name:"",price:0,currency:"CUP",description:"",image:"",category:"",isAvalaible:!0}),x()};return e.jsx(e.Fragment,{children:e.jsx(w,{isOpen:n,onOpenChange:c,placement:"top-center",children:e.jsx(E,{children:i=>e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:"flex flex-col gap-1",children:["Editar ",a.name]}),e.jsxs(P,{children:[e.jsx(S,{autoFocus:!0,required:!0,maxLength:30,label:"Nombre",placeholder:"Escribe el nombre del producto",variant:"bordered",value:a.name,onChange:o=>d({...a,name:o.target.value})}),e.jsxs("p",{children:[a.name.length," / 30"]}),e.jsx(K,{autoFocus:!0,maxLength:120,label:"Descripción",required:!0,placeholder:"Escribe la descripción del producto",variant:"bordered",value:a.description,onChange:o=>d({...a,description:o.target.value})}),e.jsxs("p",{children:[a.description.length," / 120"]}),e.jsx(se,{value:a,setValues:d}),e.jsx("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"10px"},children:e.jsx("label",{style:{fontSize:"0.75em"},children:"Selecciona una imagen."})}),e.jsx("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"10px"},children:e.jsxs("label",{style:{backgroundColor:"#5E17EB",padding:"5px 60px",borderRadius:"10px"},children:[e.jsxs("div",{children:[e.jsx(ee,{width:30}),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:g})]}),y===!0&&e.jsx(Pe,{className:"text-white",color:"secondary",label:"Subiendo la imagen..."})]})})]}),e.jsxs(N,{children:[e.jsx(f,{color:"danger",variant:"flat",onPress:i,children:"Cerrar"}),e.jsx(f,{className:"text-white",color:"secondary",onPress:()=>{m(!0),t(),m(!1),i()},children:"Editar"})]})]})})})})}function Ye({isOpen:n,onOpen:r,onOpenChange:c,productToDelete:a,fetchProducts:d}){const[g,h]=l.useState(!1),u=async x=>{h(!0),await Me(x),h(!1),d()};return e.jsx(e.Fragment,{children:e.jsx(w,{isOpen:n,onOpenChange:c,children:e.jsx(E,{children:x=>e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:["Eliminar a ",a.name]}),e.jsxs(P,{children:["¿Estás seguro de que quieres eliminar el producto"," ",a.name,"?"]}),e.jsxs(N,{children:[e.jsx(f,{color:"danger",variant:"flat",onPress:x,disabled:g,children:"Cancelar"}),e.jsx(f,{color:"primary",onPress:async()=>{await u(a.id),x()},disabled:g,children:g?"Eliminando...":"Eliminar"})]})]})})})})}function es({isOpen:n,onOpen:r,onOpenChange:c,categoryToDelete:a,fetchCategories:d,bussiness:g}){const[h,u]=l.useState(!1),x=async p=>{u(!0),await ze(p),a.current={bussiness:g.id,category:""},delete a.current.id,u(!1),d()};return e.jsx(e.Fragment,{children:e.jsx(w,{isOpen:n,onOpenChange:c,children:e.jsx(E,{children:p=>e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:["Eliminar a ",a.category]}),e.jsxs(P,{children:["¿Estás seguro de que quieres eliminar la categoria"," ",a.category,"?"]}),e.jsxs(N,{children:[e.jsx(f,{color:"danger",variant:"flat",onClick:p,disabled:h,children:"Cancelar"}),e.jsx(f,{color:"primary",onClick:async()=>{await x(a.current.id),p()},disabled:h,children:h?"Eliminando...":"Eliminar"})]})]})})})})}function ss({fetchCategories:n,isOpen:r,onOpenChange:c,categoryInput:a,bussiness:d}){const[g,h]=l.useState(!1),[u,x]=l.useState(0),p=async()=>{console.log(a.current),await We(a.current),a.current={id:"",bussiness:d.id,category:""},delete a.current.id,console.log(a.current),await n()};return e.jsx(e.Fragment,{children:e.jsx(w,{isOpen:r,onOpenChange:c,placement:"top-center",children:e.jsx(E,{children:y=>e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:"flex flex-col gap-1",children:["Editar Categoría ",a.current.category]}),e.jsxs(P,{children:[e.jsx(S,{autoFocus:!0,maxLength:30,label:"Nombre",placeholder:"Escribe el nombre de la categoría",variant:"bordered",value:a.current.category,onChange:m=>{a.current={...a.current,category:m.target.value},x(t=>t+1)}}),e.jsxs("p",{children:[a.current.category.length," / 30"]})]}),e.jsxs(N,{children:[e.jsx(f,{color:"danger",variant:"flat",onPress:y,children:"Cerrar"}),e.jsx(f,{color:"secondary",onPress:()=>{p(),y()},children:g?"Editando...":"Editar"})]})]})})})})}const as=Je().shape({name:J().required("El nombre es requerido"),description:J().required("La descripción es requerida"),price:Ke().required("El precio es requerido").positive("El precio debe ser un número positivo")});function ps(){const n=Fe(s=>s.user);Ae(s=>s.plan);const r=Z(s=>s.bussiness),c=Z(s=>s.setBussiness),a=$(s=>s.categories),d=$(s=>s.setCategories),g=I(s=>s.products),h=I(s=>s.setProducts),[u,x]=l.useState(!1),[p,y]=l.useState(g!==null?g:[]),[m,t]=l.useState(a!==null?a:[]),i=l.useRef({bussiness:r?r.id:"",category:""}),[o,b]=l.useState({name:"",price:0,currency:"CUP",description:"",image:"",category:"",isAvalaible:!0}),{isOpen:q,onOpen:H,onOpenChange:ae}=v(),re=async()=>{const s=await De(n.id);c(s),i.current={...i.current,bussiness:s.id}};l.useEffect(()=>{r===null&&n&&re()},[n,r]);const{isOpen:ne,onOpen:te,onOpenChange:ie}=v(),{isOpen:oe,onOpen:D,onOpenChange:le}=v(),{isOpen:ce,onOpen:de,onOpenChange:B}=v(),{isOpen:ue,onOpen:U,onOpenChange:xe}=v(),{isOpen:pe,onOpen:G,onOpenChange:ge}=v(),[M,F]=l.useState(""),[rs,he]=l.useState(0),_=async()=>{if(r===null)return;const s=await Ze(r.id);t(s!==null?s:[]),d(s)};l.useEffect(()=>{r&&_()},[r]);const L=async()=>{const s=await Be(m);y(s!==null?s:[]),h(s)};l.useEffect(()=>{m.length<1||L()},[m]);const me=async()=>{if(i.current.category.trim()===""){R.error("El nombre de la categoría no puede estar vacío");return}await $e(i.current),i.current={bussiness:r.id,category:""},await _(),he(s=>s+1)},je=async()=>{try{await as.validate(o,{strict:!0})}catch(A){R.error(A.message);return}const s=await Ue(o.image,M,"products"),j={...o,image:s.path};await Ge(j);let C={message:`El negocio ${r.name} tiene un nuevo producto.`,bussiness:r.id,addressee:null,bussiness_link:r.value_url};await Q(C),b({name:"",price:1,currency:"CUP",description:"",image:"",category:"",isAvalaible:!0}),await L()},z=async s=>{if(s.target.files&&s.target.files[0]){x(!0);const j=s.target.files[0],C=j.name.split(".").pop(),A=C.toLowerCase(),fe=j.name.replace(C,A);F(fe);const ye=await Ie(j,500);b(be=>({...be,image:ye})),x(!1)}};return e.jsxs("div",{children:[e.jsxs("section",{style:{marginTop:"10px"},children:[e.jsx("h3",{children:"Categorías "}),e.jsx("br",{})]}),e.jsx(Ne,{richColors:!0,duration:3e3,theme:"dark",position:"top-center"}),m.map(s=>{const j=p.filter(C=>C.category===s.id);return e.jsx(Qe,{user:n,category:s,products:j,onOpen:te,imageName:M,setImageName:F,onCategoryEditOpen:de,onCategoryEditOpenChange:B,onCategoryDeleteOpen:G,onProductEditOpen:D,onProductDeleteOpen:U,productInput:o,setProductInput:b,categoryInput:i},s.id)}),e.jsxs("label",{className:"custum-file-upload",htmlFor:"file",children:[e.jsx("div",{className:"icon",children:e.jsx(Te,{onOpen:()=>{if(m.length===1&&n.plan==="gratis"){R.error("Ha excedido la cantidad de categorias que se pueden añadir en su plan.");return}H()}})}),e.jsxs("div",{className:"text",children:[e.jsx("span",{children:"Agregar nueva categoría"}),e.jsx(w,{isOpen:ne,onOpenChange:ie,placement:"top-center",children:e.jsx(E,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"flex flex-col gap-1",children:"Agregar Producto"}),e.jsxs(P,{children:[e.jsx(S,{autoFocus:!0,required:!0,label:"Nombre",placeholder:"Escribe el nombre del producto",variant:"bordered",value:o.name,onChange:j=>b({...o,name:j.target.value})}),e.jsx(K,{autoFocus:!0,maxLength:120,label:"Descripción",placeholder:"Escribe la descripción del producto",variant:"bordered",value:o.description,onChange:j=>b({...o,description:j.target.value})}),e.jsxs("p",{children:[o.description.length," / 120"]}),e.jsx(se,{value:o,setValues:b}),e.jsx("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"10px"},children:e.jsx("label",{style:{fontSize:"0.75em"},children:"Selecciona una imagen."})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"10px"},children:[e.jsx("label",{style:{backgroundColor:"#5E17EB",padding:"5px 60px",borderRadius:"10px"},children:e.jsxs("div",{children:[e.jsx(ee,{width:30}),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:z})]})}),u&&e.jsx("p",{children:"Subiendo imagen..."})]})]}),e.jsxs(N,{children:[e.jsx(f,{color:"danger",variant:"flat",onPress:s,children:"Cerrar"}),e.jsx(f,{color:"secondary",style:{color:"white"},onPress:()=>{je(),s()},children:"Agregar"})]})]})})}),e.jsx(w,{isOpen:q,onOpenChange:ae,placement:"top-center",children:e.jsx(E,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"flex flex-col gap-1",children:"Agregar Categoría"}),e.jsx(P,{children:e.jsx(S,{autoFocus:!0,label:"Nombre",isRequired:!0,placeholder:"Escribe el nombre de la categoría",variant:"bordered",onChange:j=>{i.current={...i.current,category:j.target.value}}})}),e.jsxs(N,{children:[e.jsx(f,{color:"danger",variant:"flat",onPress:s,children:"Cerrar"}),e.jsx(f,{className:"text-white",color:"secondary",onPress:()=>{me(),s()},children:"Agregar"})]})]})})}),e.jsx(Xe,{isOpen:oe,onOpen:D,onOpenChange:le,productInput:o,setProductInput:b,handleImageChange:z,imageName:M,setImageName:F,fetchProducts:L,bussiness:r}),e.jsx(ss,{fetchCategories:_,isOpen:ce,onOpenChange:B,categoryInput:i,bussiness:r}),e.jsx(Ye,{isOpen:ue,onOpen:U,onOpenChange:xe,productToDelete:o,fetchProducts:L,bussiness:r}),e.jsx(es,{isOpen:pe,categoryToDelete:i,onOpen:G,fetchCategories:_,onOpenChange:ge,bussiness:r})]})]})]})}export{ps as default};
